// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

// URL CORRETA DO SUPABASE (for√ßar se necess√°rio)
const CORRECT_SUPABASE_URL = 'https://jibpvpqgplmahjhswiza.supabase.co';
const CORRECT_SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImppYnB2cHFncGxtYWhqaHN3aXphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1ODA0ODcsImV4cCI6MjA3NjE1NjQ4N30.raNfZtKkNUZBHiAA6yobri0YoWZt_Ioq10qMC9hfNrc';

// Usar vari√°veis de ambiente ou valores corretos como fallback
let SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL || CORRECT_SUPABASE_URL;
let SUPABASE_PUBLISHABLE_KEY = import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY || CORRECT_SUPABASE_KEY;

// FOR√áAR URL CORRETA (corrige problema de cache/URL antiga do Bolt)
if (SUPABASE_URL !== CORRECT_SUPABASE_URL) {
  console.warn('‚ö†Ô∏è [SUPABASE] URL incorreta detectada, corrigindo...');
  console.warn('   URL antiga:', SUPABASE_URL);
  SUPABASE_URL = CORRECT_SUPABASE_URL;
  console.log('‚úÖ [SUPABASE] URL corrigida para:', SUPABASE_URL);
}

// Debug: Verificar configura√ß√£o
if (!SUPABASE_URL || !SUPABASE_PUBLISHABLE_KEY) {
  console.error('‚ùå [SUPABASE] Vari√°veis de ambiente n√£o configuradas!');
  console.error('   VITE_SUPABASE_URL:', SUPABASE_URL);
  console.error('   VITE_SUPABASE_PUBLISHABLE_KEY:', SUPABASE_PUBLISHABLE_KEY ? 'OK' : 'FALTANDO');
} else {
  console.log('‚úÖ [SUPABASE] Configurado:', SUPABASE_URL);
  console.log('‚úÖ [SUPABASE] URL esperada: https://jibpvpqgplmahjhswiza.supabase.co');
  
  // Verificar se a URL est√° correta
  if (SUPABASE_URL !== 'https://jibpvpqgplmahjhswiza.supabase.co') {
    console.error('‚ùå [SUPABASE] URL INCORRETA!');
    console.error('   URL atual:', SUPABASE_URL);
    console.error('   URL esperada: https://jibpvpqgplmahjhswiza.supabase.co');
    console.error('   ‚ö†Ô∏è Verifique o arquivo .env!');
  }
}

// Import the supabase client like this:
// import { supabase } from "@/integrations/supabase/client";

// FOR√áAR URL CORRETA SEMPRE (ignora qualquer cache/env)
const FINAL_SUPABASE_URL = CORRECT_SUPABASE_URL;
const FINAL_SUPABASE_KEY = CORRECT_SUPABASE_KEY;

console.log('üîß [SUPABASE] Inicializando com URL for√ßada:', FINAL_SUPABASE_URL);

// INTERCEPTOR: Corrige URLs antigas em requisi√ß√µes
if (typeof window !== 'undefined') {
  const originalFetch = window.fetch;
  window.fetch = async function(input: RequestInfo | URL, init?: RequestInit): Promise<Response> {
    let url = typeof input === 'string' ? input : input instanceof URL ? input.toString() : input.url;
    
    // Se a URL cont√©m a URL antiga do Bolt, substituir pela correta
    if (url.includes('qbtqjrcfseqcfmcqlngr') || url.includes('gbtqjrcfseqcfmcqlngr')) {
      const correctedUrl = url.replace(/https?:\/\/[^/]+\.supabase\.co/, FINAL_SUPABASE_URL);
      console.warn('‚ö†Ô∏è [INTERCEPTOR] URL antiga detectada, corrigindo:');
      console.warn('   Antiga:', url);
      console.warn('   Nova:', correctedUrl);
      url = correctedUrl;
      
      // Recriar o input com a URL corrigida
      if (typeof input === 'string') {
        input = url;
      } else if (input instanceof URL) {
        input = new URL(url);
      } else {
        input = new Request(url, input);
      }
    }
    
    return originalFetch.call(this, input, init);
  };
  
  console.log('‚úÖ [INTERCEPTOR] Interceptor de fetch instalado');
}

export const supabase = createClient<Database>(FINAL_SUPABASE_URL, FINAL_SUPABASE_KEY, {
  auth: {
    storage: localStorage,
    persistSession: true,
    autoRefreshToken: true,
  },
  global: {
    headers: {
      'x-client-info': 'amzofertas-web'
    }
  }
});

// Verificar se o cliente est√° usando a URL correta
console.log('‚úÖ [SUPABASE] Cliente criado com URL:', supabase.supabaseUrl);